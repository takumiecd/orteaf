schema_version: "1.0"

ops:
  - id: "MatMul"
    display_name: "MatMul"
    category: "linear_algebra"
    arity: 2
    inputs:
      - name: "lhs"
        description: "Left matrix operand ([..., M, K])"
        dtype_constraints:
          mode: "allow"
          categories: ["floating_point"]
      - name: "rhs"
        description: "Right matrix operand ([..., K, N])"
        dtype_constraints:
          mode: "allow"
          categories: ["floating_point"]
      - name: "bias"
        description: "Optional bias vector ([..., N])"
        optional: true
        dtype_constraints:
          mode: "allow"
          categories: ["floating_point"]
    outputs:
      - name: "output"
        description: "Matrix product with optional bias add"
        dtype_rule:
          kind: "same_as"
          input: "lhs"
    attributes:
      - name: "transposed_lhs"
        type: "bool"
        default: false
        description: "Interpret lhs as already transposed (K, M)"
      - name: "transposed_rhs"
        type: "bool"
        default: false
        description: "Interpret rhs as already transposed (N, K)"
    compute_policy:
      kind: "derived_compute_type"
      function: "MatMulAccumulatorType"
      inputs: ["lhs", "rhs"]
    shape_inference:
      kind: "matmul"
      description: "Uses standard matrix multiplication dimension rules"
    metadata:
      description: "Batched matrix multiplication with optional bias"
      tags: ["batched", "linear_algebra"]
      commutative: false
      differentiable: true
